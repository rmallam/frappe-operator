---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.19.0
  name: siterestores.vyogo.tech
spec:
  group: vyogo.tech
  names:
    kind: SiteRestore
    listKind: SiteRestoreList
    plural: siterestores
    singular: siterestore
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - jsonPath: .status.phase
      name: Phase
      type: string
    - jsonPath: .spec.site
      name: Site
      type: string
    - jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: SiteRestore is the Schema for the siterestores API
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: SiteRestoreSpec defines the desired state of SiteRestore
            properties:
              adminPasswordSecretRef:
                description: AdminPasswordSecretRef references a secret key containing
                  the new admin password
                properties:
                  key:
                    description: The key of the secret to select from.  Must be a
                      valid secret key.
                    type: string
                  name:
                    default: ""
                    description: |-
                      Name of the referent.
                      This field is effectively required, but due to backwards compatibility is
                      allowed to be empty. Instances of this type with an empty value here are
                      almost certainly wrong.
                      More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names
                    type: string
                  optional:
                    description: Specify whether the Secret or its key must be defined
                    type: boolean
                required:
                - key
                type: object
                x-kubernetes-map-type: atomic
              benchRef:
                description: BenchRef references the bench where the site should be
                  restored
                properties:
                  name:
                    description: Name of the resource
                    type: string
                  namespace:
                    description: Namespace of the resource
                    type: string
                required:
                - name
                type: object
              databaseBackupSource:
                description: DatabaseBackupSource specifies where to get the SQL backup
                  from
                properties:
                  localPath:
                    description: LocalPath is the path relative to the bench root
                      (e.g., "sites/site1.local/private/backups/xyz.sql")
                    type: string
                  s3:
                    description: S3 specifies a file in S3-compatible storage
                    properties:
                      bucket:
                        description: Bucket name
                        type: string
                      credentialSecretRef:
                        description: CredentialSecretRef references a Secret containing
                          AWS_ACCESS_KEY_ID and AWS_SECRET_ACCESS_KEY
                        properties:
                          name:
                            description: name is unique within a namespace to reference
                              a secret resource.
                            type: string
                          namespace:
                            description: namespace defines the space within which
                              the secret name must be unique.
                            type: string
                        type: object
                        x-kubernetes-map-type: atomic
                      endpoint:
                        description: Endpoint URL (required for non-AWS providers
                          like Minio/DigitalOcean)
                        type: string
                      key:
                        description: Key is the path/name of the file in the bucket
                        type: string
                      region:
                        description: Region (optional for some providers)
                        type: string
                    required:
                    - bucket
                    - credentialSecretRef
                    - key
                    type: object
                type: object
              force:
                default: false
                description: Force bypasses the warning if a site downgrade is detected
                type: boolean
              privateFilesSource:
                description: PrivateFilesSource specifies where to get the private
                  files backup from
                properties:
                  localPath:
                    description: LocalPath is the path relative to the bench root
                      (e.g., "sites/site1.local/private/backups/xyz.sql")
                    type: string
                  s3:
                    description: S3 specifies a file in S3-compatible storage
                    properties:
                      bucket:
                        description: Bucket name
                        type: string
                      credentialSecretRef:
                        description: CredentialSecretRef references a Secret containing
                          AWS_ACCESS_KEY_ID and AWS_SECRET_ACCESS_KEY
                        properties:
                          name:
                            description: name is unique within a namespace to reference
                              a secret resource.
                            type: string
                          namespace:
                            description: namespace defines the space within which
                              the secret name must be unique.
                            type: string
                        type: object
                        x-kubernetes-map-type: atomic
                      endpoint:
                        description: Endpoint URL (required for non-AWS providers
                          like Minio/DigitalOcean)
                        type: string
                      key:
                        description: Key is the path/name of the file in the bucket
                        type: string
                      region:
                        description: Region (optional for some providers)
                        type: string
                    required:
                    - bucket
                    - credentialSecretRef
                    - key
                    type: object
                type: object
              publicFilesSource:
                description: PublicFilesSource specifies where to get the public files
                  backup from
                properties:
                  localPath:
                    description: LocalPath is the path relative to the bench root
                      (e.g., "sites/site1.local/private/backups/xyz.sql")
                    type: string
                  s3:
                    description: S3 specifies a file in S3-compatible storage
                    properties:
                      bucket:
                        description: Bucket name
                        type: string
                      credentialSecretRef:
                        description: CredentialSecretRef references a Secret containing
                          AWS_ACCESS_KEY_ID and AWS_SECRET_ACCESS_KEY
                        properties:
                          name:
                            description: name is unique within a namespace to reference
                              a secret resource.
                            type: string
                          namespace:
                            description: namespace defines the space within which
                              the secret name must be unique.
                            type: string
                        type: object
                        x-kubernetes-map-type: atomic
                      endpoint:
                        description: Endpoint URL (required for non-AWS providers
                          like Minio/DigitalOcean)
                        type: string
                      key:
                        description: Key is the path/name of the file in the bucket
                        type: string
                      region:
                        description: Region (optional for some providers)
                        type: string
                    required:
                    - bucket
                    - credentialSecretRef
                    - key
                    type: object
                type: object
              site:
                description: Site is the name of the Frappe site to restore
                type: string
            required:
            - benchRef
            - databaseBackupSource
            - site
            type: object
          status:
            description: SiteRestoreStatus defines the observed state of SiteRestore
            properties:
              completionTime:
                description: CompletionTime is the timestamp when the restore finished
                format: date-time
                type: string
              message:
                description: Message provides additional information about the restore
                  status
                type: string
              phase:
                description: Phase indicates the current phase of the restore
                type: string
              restoreJob:
                description: RestoreJob is the name of the restore job
                type: string
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
